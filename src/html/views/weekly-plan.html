<div x-data="weeklyPlanApp()" x-init="init()" class="h-full flex flex-col">
  <div class="p-4">
    <h2 class="text-xl font-semibold mb-2">Weekly Plan</h2>
    <p class="text-sm text-gray-600">If you can read this, the plan view is mounted.</p>
  </div>
      
  <div class="p-3 border-b flex items-center gap-3">
    <div class="flex-1"></div>
    <button class="px-3 py-1 rounded bg-emerald-600 text-white" @click="open()">+ Add Service</button>
  </div>

  <!-- No table/rows on this page for now -->

  <!-- Add Service modal -->
  <div x-show="showAddService" x-cloak class="fixed inset-0 z-50 flex items-center justify-center">
    <div class="absolute inset-0 bg-black/40" @click="showAddService=false"></div>
    <div class="relative bg-white rounded shadow-lg w-[560px] max-w-[95vw] p-4">
      <h3 class="text-lg font-semibold mb-3">Add Service</h3>
      <div class="flex gap-2">
        <label class="text-sm">Date
          <input type="date" class="mt-1 w-full border rounded px-2 py-1" x-model="form.date">
        </label>
        <label class="text-sm">Time
          <input type="text" class="mt-1 w-full border rounded px-2 py-1" placeholder="10:00 AM" x-model="form.time">
        </label>
        <label class="text-sm">Service Type
          <input type="text" class="mt-1 w-full border rounded px-2 py-1" x-model="form.type">
        </label>
      </div>
      <div class="flex gap-2">
        <label class="text-sm flex-1">Leader
          <div class="mt-1">
            <select x-ref="leaderSel" class="border rounded px-2 py-1 w-full" x-model="leaderSelect" @change="form.leader = leaderSelect==='__custom' ? '' : leaderSelect">
              <template x-for="n in leaderChoices" :key="'lead-'+n">
                <option :value="n" x-text="n"></option>
              </template>
              <option value="__custom">Custom…</option>
            </select>
          </div>
          <template x-if="leaderSelect==='__custom'">
            <input type="text" class="mt-2 w-full border rounded px-2 py-1" placeholder="Type leader name" x-model="form.leader">
          </template>
        </label>
        <label class="text-sm flex-1">Sermon
          <div class="mt-1">
            <select x-ref="sermonSel" class="border rounded px-2 py-1 w-full" x-model="sermonSelect" @change="form.sermon = sermonSelect==='__custom' ? '' : sermonSelect">
              <template x-for="n in sermonChoices" :key="'serm-'+n">
                <option :value="n" x-text="n"></option>
              </template>
              <option value="__custom">Custom…</option>
            </select>
          </div>
          <template x-if="sermonSelect==='__custom'">
            <input type="text" class="mt-2 w-full border rounded px-2 py-1" placeholder="Type preacher name" x-model="form.sermon">
          </template>
        </label>
      </div>
      <div>
        <label class="text-sm col-span-2">Scripture
          <div class="mt-1 grid grid-cols-6 gap-2 items-center">
            <select x-ref="bookSel" class="col-span-3 border rounded px-2 py-1" x-model="scripture.book">
              <template x-for="b in books" :key="b[0]"><option :value="b[0]" x-text="b[0]"></option></template>
            </select>
            <select x-ref="chapterSel" class="col-span-1 border rounded px-2 py-1" x-model.number="scripture.chapter">
              <template x-for="n in chapterCountFor(scripture.book)" :key="'ch-'+n"><option :value="n" x-text="n"></option></template>
            </select>
            <input class="col-span-1 border rounded px-2 py-1" type="number" min="1" placeholder="v" x-model="scripture.start">
            <input class="col-span-1 border rounded px-2 py-1" type="number" min="1" placeholder="to" x-model="scripture.end">
          </div>
          <div class="mt-2 flex items-center gap-2 text-sm text-gray-600">
            <span x-text="scriptureRef()"></span>

          </div>
        </label>
        <label class="text-sm col-span-2">Theme
          <input type="text" class="mt-1 w-full border rounded px-2 py-1" x-model="form.theme">
        </label>
        <label class="text-sm col-span-2">Notes
          <textarea class="mt-1 w-full border rounded px-2 py-1" rows="3" x-model="form.notes"></textarea>
        </label>
      </div>
      
      <div class="mt-4 flex justify-end gap-2">
        <button class="px-3 py-1 rounded border" @click="showAddService=false">Cancel</button>
        <button class="px-3 py-1 rounded bg-emerald-600 text-white" @click="submit()">Add Service</button>
      </div>

      <!-- no datalists; using select + custom field -->
    </div>
  </div>
</div>
